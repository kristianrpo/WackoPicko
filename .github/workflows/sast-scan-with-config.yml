name: SAST Scan - With Config (Fail on Vulnerabilities)

on:
  workflow_dispatch:

jobs:
  sast-scan-with-config:
    name: Fluid Attacks SAST Scan - With Config
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Validate config.yaml exists
        run: |
          if [ ! -f config.yaml ]; then
            echo "Error: config.yaml no encontrado"
            exit 1
          fi
          echo "config.yaml encontrado"
          
      - name: Run Fluid Attacks SAST Scan (Fail on Vulnerabilities)
        id: sast_scan
        run: |
          docker run --rm \
            -v "$PWD:/src" \
            fluidattacks/sast:latest \
            sast scan /src/config.yaml
          
      - name: Upload scan results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: sast-results-with-config
          path: |
            Fluid-Attacks-Results.csv
          retention-days: 30


